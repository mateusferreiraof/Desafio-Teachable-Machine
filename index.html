<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8" />
    <title>Reconhecimento de Ma√ß√£ üçé</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h2>√â ma√ß√£ ? üçé</h2>

    <input type="file" id="inputImage" accept="image/*" />
    <p id="result">Modelo carregado! Escolha uma imagem.</p>
    <p>Visualiza√ß√£o da imagem:</p>
    <img id="preview" alt="" width="300" />

    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>

    <script>
        // URL do modelo (n√£o sobrescreve a vari√°vel global URL)
        const MODEL_URL = "./my_model/";

        let model;

        // Carrega o modelo
        async function init() {
            model = await tmImage.load(MODEL_URL + "model.json", MODEL_URL + "metadata.json");
            document.getElementById("result").innerText = "Modelo carregado! Escolha uma imagem.";
        }

        // Fun√ß√£o para fazer a predi√ß√£o com a imagem selecionada
        async function predictImage(img) {
            const prediction = await model.predict(img);
            let maior = prediction[0];

            for (let i = 1; i < prediction.length; i++) {
                if (prediction[i].probability > maior.probability) maior = prediction[i];
            }

            if (maior.probability > 0.7 && maior.className === "Ma√ß√£") {
                document.getElementById("result").innerText = 
                    `Detectado Ma√ß√£ üçé com ${(maior.probability * 100).toFixed(1)}% de confian√ßa!`;
            } else if (maior.probability > 0.7) {
                document.getElementById("result").innerText = 
                    `Detectado: ${maior.className} (${(maior.probability * 100).toFixed(1)}%)`;
            } else {
                document.getElementById("result").innerText = "Imagem n√£o reconhecida com confian√ßa suficiente.";
            }

            console.log(prediction);
        }

        const input = document.getElementById("inputImage");
        const preview = document.getElementById("preview");

        // Atualiza preview e chama predi√ß√£o ao escolher imagem
        input.addEventListener("change", (e) => {
            const file = e.target.files[0];
            if (!file) return;

            preview.src = URL.createObjectURL(file);

            preview.onload = () => predictImage(preview);
        });

        // Inicializa o modelo
        init();
    </script>
</body>
</html>
